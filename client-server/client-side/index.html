<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Image Prediction</title>
    </head>

    <body>

		<h1>Stato del Servizio</h1>
		<div id="service_status"></div>
		
		</br>


			<input type="file" id="userImagePath" name="userImagePath"  accept="image/*">
			<button onclick="handleImageUpload()">Invia</button>

		</br>


		
		<h1>ID Richiesta</h1>
		<div id="request_id"></div>
		
		</br>
			
		<h1>Analisi</h1>
		<div id="analysis"></div>
		
		</br>
				
		<h1>Immagine</h1>
		<div id="response_image"></div>

		</br></br>
		
		<small class="copyright">.:. Copyright &copy;2020-<script>document.write(new Date().getFullYear())</script>	CM-InnovationLab.it .:. All Rights Reserved .:.</small>
    </body>

	<script language="javascript">
		var xhttp = new XMLHttpRequest();
		var url = "http://127.0.0.1:5001/api/v2/test";
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				const obj = JSON.parse(this.responseText);
				document.getElementById("service_status").innerHTML = obj.status;
			}
		}
		xhttp.open("GET", url);
		xhttp.send();






		const formData = new FormData()


		function handleImageUpload () {
		//	const handleImageUpload = event => {
			




			var xhttp2 = new XMLHttpRequest();
			var url = "http://127.0.0.1:5001/api/v2/img/inference";
			xhttp2.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					const obj = JSON.parse(this.responseText);
					document.getElementById("request_id").innerHTML = obj.counter;
					document.getElementById("analysis").innerHTML = obj.analysis;
					document.getElementById("response_image").innerHTML = obj.image;
				}
			}
			xhttp2.open("POST", url);
			//xhttp2.setRequestHeader('Content-Type','multipart/form-data')
			xhttp2.send(formData);








/*
			fetch('http://127.0.0.1:5001/api/v2/img/inference', {
				method: 'POST',
				body: formData
				//xhttp2.setRequestHeader('Content-Type','multipart/form-data')
			})
			.then(response => response.json())
			.then(data => {
				console.log(data.path)
			//	const obj = JSON.parse(this.responseText);
			//		document.getElementById("request_id").innerHTML = obj.counter;
			//		document.getElementById("analysis").innerHTML = obj.analysis;
			//		document.getElementById("response_image").innerHTML = obj.image;
			})
			.catch(error => {
				console.error(error)
			})*/
		}


		document.querySelector('#userImagePath').addEventListener('change', event => {
			formData.append('userImage', event.target.files[0])
			//handleImageUpload(event)
		})



	
			
	








	
	</script>
</html>